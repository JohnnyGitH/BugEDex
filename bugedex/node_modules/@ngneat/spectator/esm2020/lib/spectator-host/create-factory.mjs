import { TestBed, waitForAsync } from '@angular/core/testing';
import { By } from '@angular/platform-browser';
import { BrowserDynamicTestingModule } from '@angular/platform-browser-dynamic/testing';
import { setProps } from '../internals/query';
import * as customMatchers from '../matchers';
import { overrideComponentIfProviderOverridesSpecified, overrideModules } from '../spectator/create-factory';
import { addMatchers } from '../core';
import { isType } from '../types';
import { nodeByDirective } from '../internals/node-by-directive';
import { initialSpectatorWithHostModule } from './initial-module';
import { getSpectatorHostDefaultOptions } from './options';
import { SpectatorHost } from './spectator-host';
export function createHostFactory(typeOrOptions) {
    const options = isType(typeOrOptions)
        ? getSpectatorHostDefaultOptions({ component: typeOrOptions })
        : getSpectatorHostDefaultOptions(typeOrOptions);
    const moduleMetadata = initialSpectatorWithHostModule(options);
    beforeEach(waitForAsync(() => {
        addMatchers(customMatchers);
        TestBed.configureTestingModule(moduleMetadata).overrideModule(BrowserDynamicTestingModule, {
            set: {
                entryComponents: moduleMetadata.entryComponents
            }
        });
        overrideModules(options);
        overrideComponentIfProviderOverridesSpecified(options);
        if (options.template) {
            TestBed.overrideComponent(options.host, {
                set: { template: options.template }
            });
        }
    }));
    return (template, overrides) => {
        const defaults = { props: {}, hostProps: {}, detectChanges: true, providers: [] };
        const { detectChanges, props, hostProps, providers } = { ...defaults, ...overrides };
        if (providers && providers.length) {
            providers.forEach((provider) => {
                TestBed.overrideProvider(provider.provide, provider);
            });
        }
        if (template) {
            TestBed.overrideComponent(options.host, {
                set: { template: template }
            });
        }
        const spectator = createSpectatorHost(options, props, hostProps);
        if (options.detectChanges && detectChanges) {
            spectator.detectChanges();
        }
        return spectator;
    };
}
function createSpectatorHost(options, props, hostProps) {
    const hostFixture = TestBed.createComponent(options.host);
    const debugElement = hostFixture.debugElement.query(By.directive(options.component)) || hostFixture.debugElement;
    const debugNode = hostFixture.debugElement.queryAllNodes(nodeByDirective(options.component))[0];
    if (!debugNode) {
        throw new Error(`Cannot find component/directive ${options.component} in host template ðŸ˜”`);
    }
    const hostComponent = setProps(hostFixture.componentInstance, hostProps);
    const component = setProps(debugNode.injector.get(options.component), props);
    return new SpectatorHost(hostComponent, hostFixture.debugElement, hostFixture.nativeElement, hostFixture, debugElement, component, debugElement.nativeElement);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLWZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zcGVjdGF0b3Ivc3JjL2xpYi9zcGVjdGF0b3ItaG9zdC9jcmVhdGUtZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzlELE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUV4RixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDOUMsT0FBTyxLQUFLLGNBQWMsTUFBTSxhQUFhLENBQUM7QUFDOUMsT0FBTyxFQUFFLDZDQUE2QyxFQUFFLGVBQWUsRUFBc0IsTUFBTSw2QkFBNkIsQ0FBQztBQUNqSSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDbEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBR2pFLE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSw4QkFBOEIsRUFBd0IsTUFBTSxXQUFXLENBQUM7QUFDakYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBbUNqRCxNQUFNLFVBQVUsaUJBQWlCLENBQXVCLGFBQW1EO0lBQ3pHLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUM7UUFDbkMsQ0FBQyxDQUFDLDhCQUE4QixDQUFPLEVBQUUsU0FBUyxFQUFFLGFBQWEsRUFBRSxDQUFDO1FBQ3BFLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUVsRCxNQUFNLGNBQWMsR0FBRyw4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QUFTLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUU3RSxPQUFPLElBQUksYUFBYSxDQUN0QixhQUFhLEVBQ2IsV0FBVyxDQUFDLFlBQVksRUFDeEIsV0FBVyxDQUFDLGFBQWEsRUFDekIsV0FBVyxFQUNYLFlBQVksRUFDWixTQUFTLEVBQ1QsWUFBWSxDQUFDLGFBQWEsQ0FDM0IsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm92aWRlciwgVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGVzdEJlZCwgd2FpdEZvckFzeW5jIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS90ZXN0aW5nJztcbmltcG9ydCB7IEJ5IH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgeyBCcm93c2VyRHluYW1pY1Rlc3RpbmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyLWR5bmFtaWMvdGVzdGluZyc7XG5cbmltcG9ydCB7IHNldFByb3BzIH0gZnJvbSAnLi4vaW50ZXJuYWxzL3F1ZXJ5JztcbmltcG9ydCAqIGFzIGN1c3RvbU1hdGNoZXJzIGZyb20gJy4uL21hdGNoZXJzJztcbmltcG9ydCB7IG92ZXJyaWRlQ29tcG9uZW50SWZQcm92aWRlck92ZXJyaWRlc1NwZWNpZmllZCwgb3ZlcnJpZGVNb2R1bGVzLCBTcGVjdGF0b3JPdmVycmlkZXMgfSBmcm9tICcuLi9zcGVjdGF0b3IvY3JlYXRlLWZhY3RvcnknO1xuaW1wb3J0IHsgYWRkTWF0Y2hlcnMgfSBmcm9tICcuLi9jb3JlJztcbmltcG9ydCB7IGlzVHlwZSB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IG5vZGVCeURpcmVjdGl2ZSB9IGZyb20gJy4uL2ludGVybmFscy9ub2RlLWJ5LWRpcmVjdGl2ZSc7XG5cbmltcG9ydCB7IEhvc3RDb21wb25lbnQgfSBmcm9tICcuL2hvc3QtY29tcG9uZW50JztcbmltcG9ydCB7IGluaXRpYWxTcGVjdGF0b3JXaXRoSG9zdE1vZHVsZSB9IGZyb20gJy4vaW5pdGlhbC1tb2R1bGUnO1xuaW1wb3J0IHsgZ2V0U3BlY3RhdG9ySG9zdERlZmF1bHRPcHRpb25zLCBTcGVjdGF0b3JIb3N0T3B0aW9ucyB9IGZyb20gJy4vb3B0aW9ucyc7XG5pbXBvcnQgeyBTcGVjdGF0b3JIb3N0IH0gZnJvbSAnLi9zcGVjdGF0b3ItaG9zdCc7XG5cbi8qKlxuICogQHB1YmxpY0FwaVxuICovXG5leHBvcnQgdHlwZSBTcGVjdGF0b3JIb3N0RmFjdG9yeTxDLCBIPiA9IDxIUD4oXG4gIHRlbXBsYXRlOiBzdHJpbmcsXG4gIG92ZXJyaWRlcz86IFNwZWN0YXRvckhvc3RPdmVycmlkZXM8QywgSCwgSFA+XG4pID0+IFNwZWN0YXRvckhvc3Q8QywgSCAmIChIb3N0Q29tcG9uZW50IGV4dGVuZHMgSCA/IEhQIDogdW5rbm93bik+O1xuXG4vKipcbiAqIEBwdWJsaWNBcGlcbiAqL1xuZXhwb3J0IHR5cGUgUHJlc2V0U3BlY3RhdG9ySG9zdEZhY3Rvcnk8QywgSD4gPSA8SFA+KFxuICB0ZW1wbGF0ZT86IHN0cmluZyxcbiAgb3ZlcnJpZGVzPzogU3BlY3RhdG9ySG9zdE92ZXJyaWRlczxDLCBILCBIUD5cbikgPT4gU3BlY3RhdG9ySG9zdDxDLCBIICYgKEhvc3RDb21wb25lbnQgZXh0ZW5kcyBIID8gSFAgOiB1bmtub3duKT47XG5cbi8qKlxuICogQHB1YmxpY0FwaVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNwZWN0YXRvckhvc3RPdmVycmlkZXM8QywgSCwgSFA+IGV4dGVuZHMgU3BlY3RhdG9yT3ZlcnJpZGVzPEM+IHtcbiAgaG9zdFByb3BzPzogSG9zdENvbXBvbmVudCBleHRlbmRzIEggPyBIUCA6IFBhcnRpYWw8SD47XG59XG5cbi8qKlxuICogQHB1YmxpY0FwaVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSG9zdEZhY3Rvcnk8QywgSCA9IEhvc3RDb21wb25lbnQ+KFxuICBvcHRpb25zOiBTcGVjdGF0b3JIb3N0T3B0aW9uczxDLCBIPiAmIHsgdGVtcGxhdGU6IHN0cmluZyB9XG4pOiBQcmVzZXRTcGVjdGF0b3JIb3N0RmFjdG9yeTxDLCBIPjtcbi8qKlxuICogQHB1YmxpY0FwaVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSG9zdEZhY3Rvcnk8QywgSCA9IEhvc3RDb21wb25lbnQ+KHR5cGVPck9wdGlvbnM6IFR5cGU8Qz4gfCBTcGVjdGF0b3JIb3N0T3B0aW9uczxDLCBIPik6IFNwZWN0YXRvckhvc3RGYWN0b3J5PEMsIEg+O1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUhvc3RGYWN0b3J5PEMsIEggPSBIb3N0Q29tcG9uZW50Pih0eXBlT3JPcHRpb25zOiBUeXBlPEM+IHwgU3BlY3RhdG9ySG9zdE9wdGlvbnM8QywgSD4pOiBTcGVjdGF0b3JIb3N0RmFjdG9yeTxDLCBIPiB7XG4gIGNvbnN0IG9wdGlvbnMgPSBpc1R5cGUodHlwZU9yT3B0aW9ucylcbiAgICA/IGdldFNwZWN0YXRvckhvc3REZWZhdWx0T3B0aW9uczxDLCBIPih7IGNvbXBvbmVudDogdHlwZU9yT3B0aW9ucyB9KVxuICAgIDogZ2V0U3BlY3RhdG9ySG9zdERlZmF1bHRPcHRpb25zKHR5cGVPck9wdGlvbnMpO1xuXG4gIGNvbnN0IG1vZHVsZU1ldGFkYXRhID0gaW5pdGlhbFNwZWN0YXRvcldpdGhIb3N0TW9kdWxlPEMsIEg+KG9wdGlvbnMpO1xuXG4gIGJlZm9yZUVhY2goXG4gICAgd2FpdEZvckFzeW5jKCgpID0+IHtcbiAgICAgIGFkZE1hdGNoZXJzKGN1c3RvbU1hdGNoZXJzKTtcbiAgICAgIFRlc3RCZWQuY29uZmlndXJlVGVzdGluZ01vZHVsZShtb2R1bGVNZXRhZGF0YSkub3ZlcnJpZGVNb2R1bGUoQnJvd3NlckR5bmFtaWNUZXN0aW5nTW9kdWxlLCB7XG4gICAgICBzZXQ6IHtcbiAgICAgICAgZW50cnlDb21wb25lbnRzOiBtb2R1bGVNZXRhZGF0YS5lbnRyeUNvbXBvbmVudHNcbiAgICAgIH1cbiAgICB9KTtcblxuICAgICAgb3ZlcnJpZGVNb2R1bGVzKG9wdGlvbnMpO1xuXG4gICAgICBvdmVycmlkZUNvbXBvbmVudElmUHJvdmlkZXJPdmVycmlkZXNTcGVjaWZpZWQob3B0aW9ucyk7XG4gICAgICBpZiAob3B0aW9ucy50ZW1wbGF0ZSkge1xuICAgICAgICBUZXN0QmVkLm92ZXJyaWRlQ29tcG9uZW50KG9wdGlvbnMuaG9zdCwge1xuICAgICAgICAgICBzZXQ6IHsgdGVtcGxhdGU6IG9wdGlvbnMudGVtcGxhdGUgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KVxuICApO1xuXG4gIHJldHVybiA8SFA+KHRlbXBsYXRlPzogc3RyaW5nLCBvdmVycmlkZXM/OiBTcGVjdGF0b3JIb3N0T3ZlcnJpZGVzPEMsIEgsIEhQPikgPT4ge1xuICAgIGNvbnN0IGRlZmF1bHRzOiBTcGVjdGF0b3JIb3N0T3ZlcnJpZGVzPEMsIEgsIEhQPiA9IHsgcHJvcHM6IHt9LCBob3N0UHJvcHM6IHt9IGFzIGFueSwgZGV0ZWN0Q2hhbmdlczogdHJ1ZSwgcHJvdmlkZXJzOiBbXSB9O1xuICAgIGNvbnN0IHsgZGV0ZWN0Q2hhbmdlcywgcHJvcHMsIGhvc3RQcm9wcywgcHJvdmlkZXJzIH0gPSB7IC4uLmRlZmF1bHRzLCAuLi5vdmVycmlkZXMgfTtcblxuICAgIGlmIChwcm92aWRlcnMgJiYgcHJvdmlkZXJzLmxlbmd0aCkge1xuICAgICAgcHJvdmlkZXJzLmZvckVhY2goKHByb3ZpZGVyOiBQcm92aWRlcikgPT4ge1xuICAgICAgICBUZXN0QmVkLm92ZXJyaWRlUHJvdmlkZXIoKHByb3ZpZGVyIGFzIGFueSkucHJvdmlkZSwgcHJvdmlkZXIgYXMgYW55KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICh0ZW1wbGF0ZSkge1xuICAgICAgVGVzdEJlZC5vdmVycmlkZUNvbXBvbmVudChvcHRpb25zLmhvc3QsIHtcbiAgICAgICAgc2V0OiB7IHRlbXBsYXRlOiB0ZW1wbGF0ZSB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBzcGVjdGF0b3IgPSBjcmVhdGVTcGVjdGF0b3JIb3N0KG9wdGlvbnMsIHByb3BzLCBob3N0UHJvcHMpO1xuXG4gICAgaWYgKG9wdGlvbnMuZGV0ZWN0Q2hhbmdlcyAmJiBkZXRlY3RDaGFuZ2VzKSB7XG4gICAgICBzcGVjdGF0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cblxuICAgIHJldHVybiBzcGVjdGF0b3I7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNwZWN0YXRvckhvc3Q8QywgSCwgSFA+KFxuICBvcHRpb25zOiBSZXF1aXJlZDxTcGVjdGF0b3JIb3N0T3B0aW9uczxDLCBIPj4sXG4gIHByb3BzPzogUGFydGlhbDxDPixcbiAgaG9zdFByb3BzPzogSFBcbik6IFNwZWN0YXRvckhvc3Q8QywgSCAmIEhQPiB7XG4gIGNvbnN0IGhvc3RGaXh0dXJlID0gVGVzdEJlZC5jcmVhdGVDb21wb25lbnQob3B0aW9ucy5ob3N0KTtcbiAgY29uc3QgZGVidWdFbGVtZW50ID0gaG9zdEZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5KEJ5LmRpcmVjdGl2ZShvcHRpb25zLmNvbXBvbmVudCkpIHx8IGhvc3RGaXh0dXJlLmRlYnVnRWxlbWVudDtcbiAgY29uc3QgZGVidWdOb2RlID0gaG9zdEZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5QWxsTm9kZXMobm9kZUJ5RGlyZWN0aXZlKG9wdGlvbnMuY29tcG9uZW50KSlbMF07XG5cbiAgaWYgKCFkZWJ1Z05vZGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBmaW5kIGNvbXBvbmVudC9kaXJlY3RpdmUgJHtvcHRpb25zLmNvbXBvbmVudH0gaW4gaG9zdCB0ZW1wbGF0ZSDwn5iUYCk7XG4gIH1cblxuICBjb25zdCBob3N0Q29tcG9uZW50ID0gc2V0UHJvcHMoaG9zdEZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UsIGhvc3RQcm9wcyk7XG4gIGNvbnN0IGNvbXBvbmVudCA9IHNldFByb3BzKGRlYnVnTm9kZS5pbmplY3Rvci5nZXQob3B0aW9ucy5jb21wb25lbnQpLCBwcm9wcyk7XG5cbiAgcmV0dXJuIG5ldyBTcGVjdGF0b3JIb3N0KFxuICAgIGhvc3RDb21wb25lbnQsXG4gICAgaG9zdEZpeHR1cmUuZGVidWdFbGVtZW50LFxuICAgIGhvc3RGaXh0dXJlLm5hdGl2ZUVsZW1lbnQsXG4gICAgaG9zdEZpeHR1cmUsXG4gICAgZGVidWdFbGVtZW50LFxuICAgIGNvbXBvbmVudCxcbiAgICBkZWJ1Z0VsZW1lbnQubmF0aXZlRWxlbWVudFxuICApO1xufVxuIl19